# =============================================================================
# Audit Event Identifier: DSU-TST-1000087
# Last Updated: 2026-02-28
# =============================================================================
---
# CIS Docker Benchmark | Pod Security Standards
- hosts: localhost
  connection: local
  gather_facts: false
  vars:
    containers_secrets_dir: "{{ playbook_dir }}/molecule_shared"
    containers_secrets_owner: "{{ lookup('env','USER') }}"
    containers_media_fail_secure: true
    containers_transmission_enable: true
    test_case: "{{ lookup('env','test_case') | default('missing_file') }}"
  tasks:
    - name: Ensure molecule_shared exists
      ansible.builtin.file:
        path: "{{ containers_secrets_dir }}"
        state: directory
        mode: '0700'

    # Test Case 1: Missing transmission user (should fail)
    - name: Set transmission pass only for missing user test
      ansible.builtin.set_fact:
        containers_transmission_pass: "real_pass"
      when: test_case in ['missing_transmission_user', 'missing_file']

    # Test Case 2: Missing transmission pass (should fail)
    - name: Set transmission user only for missing pass test
      ansible.builtin.set_fact:
        containers_transmission_user: "real_user"
      when: test_case in ['missing_transmission_pass', 'wrong_permissions']

    # Test Case 3: Empty transmission user (should fail)
    - name: Set empty transmission user for test
      ansible.builtin.set_fact:
        containers_transmission_user: ""
        containers_transmission_pass: "real_pass"
      when: test_case in ['empty_transmission_user', 'placeholder_values']

    # Test Case 4: Empty transmission pass (should fail)
    - name: Set empty transmission pass for test
      ansible.builtin.set_fact:
        containers_transmission_user: "real_user"
        containers_transmission_pass: ""
      when: test_case in ['empty_transmission_pass', 'wrong_owner']

    # Default: valid transmission credentials for any other test cases
    - name: Set valid transmission credentials for baseline
      ansible.builtin.set_fact:
        containers_transmission_user: "real_user"
        containers_transmission_pass: "real_pass"
      when: >-
        test_case not in [
          'missing_transmission_user',
          'missing_transmission_pass',
          'empty_transmission_user',
          'empty_transmission_pass',
          'missing_file',
          'wrong_permissions',
          'placeholder_values',
          'wrong_owner'
        ]
