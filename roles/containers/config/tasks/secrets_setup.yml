---
# Secure Secrets Management
# Moves sensitive variables from Unit files (world-readable) to strict-permission env files.

- name: "VOLATILE | Set canonical secrets directory"
  ansible.builtin.set_fact:
    containers_secrets_dir: >-
      {{
        '/run/secrets/dsu'
        if (deployment_profile in ['hardened', 'production', 'ephemeral'] or ephemeral_volatile_secrets | default(false) | bool)
        else '/srv/containers/configs/secrets'
      }}
  tags: [security, containers, config, volatile]

- name: "ISO 27001 ยง10.1 | Action 400010 | Create Secrets Configuration Directory"
  ansible.builtin.file:
    path: "{{ containers_secrets_dir }}"
    state: directory
    mode: '0700'
    owner: "{{ containers_secrets_owner }}"
    group: "{{ containers_secrets_group }}"
  become: true
  tags: [security, containers, config, iso27001]
