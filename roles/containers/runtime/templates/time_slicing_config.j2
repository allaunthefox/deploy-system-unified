{# =============================================================================
# Audit Event Identifier: DSU-TPL-900014
# Template Type: runtime Configuration
# Last Updated: 2026-02-28
# Version: 1.0
# ============================================================================= #}
# NVIDIA Container Runtime Configuration
# This file is automatically generated by Ansible

[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    [plugins."io.containerd.grpc.v1.cri".containerd]
      default_runtime_name = "nvidia"

      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia]
          runtime_type = "io.containerd.runc.v2"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.nvidia.options]
            BinaryName = "nvidia-container-runtime"

    [plugins."io.containerd.grpc.v1.cri".containerd.default_runtime_opts]
      [plugins."io.containerd.grpc.v1.cri".containerd.default_runtime_opts.nvidia]
        envs = ["NVIDIA_VISIBLE_DEVICES=all"]
        [plugins."io.containerd.grpc.v1.cri".containerd.default_runtime_opts.nvidia.labels]
          "com.nvidia.container.needed": "nvidia-driver"

# Time-slicing configuration
[time-slicing]
  [time-slicing.nvidia]
    enabled = {{ containers_gpu_slicing.time_slicing.enabled }}
    max_instances = {{ containers_gpu_slicing.time_slicing.max_instances }}
    slice_size = "100ms"

    [time-slicing.nvidia.resources]
      gpu = {{ containers_gpu_count_detected }}
      memory = "100%"