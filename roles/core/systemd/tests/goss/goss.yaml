# Goss tests for core/systemd role
# CIS 5.2.x, 5.3.x | STIG V-230260, V-230261 | NIST AU-2, AU-3, AU-12, CM-6 | ISO 27001 ยง12.4, ยง8.26
---
service:
  systemd-journald:
    enabled: true
    running: true
  systemd-resolved:
    enabled: true
    running: true

file:
  /etc/systemd/journald.conf:
    exists: true
    mode: "0644"
  /etc/systemd/resolved.conf:
    exists: true
    mode: "0644"
  /var/log/journal:
    exists: true
    is-dir: true

command:
  # Verify systemd is running
  systemctl is-system-running:
    exit-status: 0
    stdout:
      - "running"
      - "degraded"
  # Verify journalctl works
  journalctl --no-pager -n 1:
    exit-status: 0
  # Verify resolved is running
  systemctl is-active systemd-resolved:
    exit-status: 0
