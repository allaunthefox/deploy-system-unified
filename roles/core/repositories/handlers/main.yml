# =============================================================================
# Audit Event Identifier: DSU-PLY-100465
# Last Updated: 2026-02-28
# =============================================================================
---
# NIST SP 800-53 CM-5 | ISO 27001 ยง12.1
# Handlers for core/repositories role
# Note: Repository configuration changes typically don't require service restarts
# Package managers read repository configs on each invocation

- name: clean_apt_cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 0
  become: true
  listen: "clean apt cache"
  when: ansible_os_family == 'Debian'
  changed_when: true

- name: clean_dnf_cache
  ansible.builtin.command: dnf clean all
  become: true
  listen: "clean dnf cache"
  when: ansible_os_family == 'RedHat'
  changed_when: true
  failed_when: false

- name: clean_pacman_cache
  ansible.builtin.command: pacman -Sc --noconfirm
  become: true
  listen: "clean pacman cache"
  when: ansible_os_family == 'Archlinux'
  changed_when: true
  failed_when: false

- name: clean_apk_cache
  ansible.builtin.command: apk cache clean
  become: true
  listen: "clean apk cache"
  when: ansible_os_family == 'Alpine'
  changed_when: true
  failed_when: false
