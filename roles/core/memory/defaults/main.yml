# =============================================================================
# Audit Event Identifier: DSU-PLY-100455
# Last Updated: 2026-02-28
# =============================================================================
---
# NIST SP 800-53 CM-5 | ISO 27001 ยง12.1
# Defaults for core/memory

# Optimization Strategy: 'auto', 'zram', 'zswap', 'none'
# auto:
#   - Use zram if < 8GB RAM (Standard setup)
#   - Use zswap if > 8GB RAM (Hybrid setup with physical swap)
#   - Use zram if system has NO physical swap partition
#   - Use zram if system uses Shared Video Memory (IGPU/APU) to minimize bus contention
core_memory_compression_strategy: auto

# Shared Video Memory Handling
# If true, forces 'zram' strategy to favor latency over capacity.
# auto: attempts to detect Integrated Graphics (Intel/AMD APU)
core_memory_shared_vram: auto

# Workload Profile: 'standard', 'database', 'latency-sensitive'
# standard: Balanced throughput/latency. Uses Aggressive ZRAM/ZSwap.
# database: Low Swappiness (10), THP=madvise, tuned Dirty Ratios. Preserves Page Cache.
# latency-sensitive: Disables THP, Low Swappiness, disables swapiness generally.
core_memory_workload_profile: standard

# Transparent Huge Pages (THP)
# Options: 'always', 'madvise', 'never'
# Databases (Redis, Mongo, Postgres) usually prefer 'madvise' or 'never'.
core_memory_thp_state: always

# ZRAM Configuration
core_memory_zram_size_percent: 50
core_memory_zram_algorithm: zstd
core_memory_zram_priority: 100

# ZSwap Configuration
core_memory_zswap_compressor: zstd
core_memory_zswap_zpool: zsmalloc
core_memory_zswap_max_pool_percent: 20

# Sysctl Tuning
# Standard Profile uses High Swappiness (100) for ZRAM efficiency.
# Database Profile overrides these to (10) and (100) respectively.
core_memory_swappiness: "{{ 10 if core_memory_workload_profile == 'database' else 100 }}"
core_memory_cache_pressure: "{{ 100 if core_memory_workload_profile == 'database' else 100 }}"

# Dirty Page Tuning (Writeback Behavior)
# Standard: Let OS handle it (usually ratio-based).
# Database: Prefer fixed bytes to avoid "Stall on Flushing" large RAM buffers.
core_memory_dirty_bytes: "{{ '536870912' if core_memory_workload_profile == 'database' else 0 }}" # 512MB
core_memory_dirty_background_bytes: "{{ '268435456' if core_memory_workload_profile == 'database' else 0 }}" # 256MB
