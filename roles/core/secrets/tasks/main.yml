# =============================================================================
# Audit Event Identifier: DSU-PLY-100476
# Last Updated: 2026-02-28
# =============================================================================
---
# Tasks for core/secrets - Secrets Management & Integrity
# This role handles secure secret deployment with built-in integrity verification
# CIS 5.5.x | STIG V-230290 | NIST IA-5, SC-12, SC-28 | ISO 27001 ยง8.24

- name: "CIS 5.5.1 | STIG V-230290 | NIST IA-5, SC-28 | ISO 27001 ยง8.24 | Audit Code 400010 | Ensure secrets directory exists"
  ansible.builtin.file:
    path: /etc/ansible/secrets
    state: directory
    mode: '0700'
    owner: root
    group: root
  become: true
  tags:
    - cis_5_5_1
    - stig_v_230290
    - nist_ia_5
    - nist_sc_28
    - iso_27001_8_24
    - secrets
    - security
    - remediate

- name: "VOLATILE | Initialize RAM-disk infrastructure"
  ansible.builtin.include_tasks: volatile_mount.yml
  tags: [secrets, volatile]

- name: "CIS 5.5.1 | STIG V-230290 | NIST IA-5, SC-12 | ISO 27001 ยง8.24 | Audit Code 400011 | Deploy secrets from vault"
  ansible.builtin.debug:
    msg: "Secrets deployment handled via Ansible Vault - no additional tasks required"
  when: core_secrets_enabled | default(true)
  tags:
    - cis_5_5_1
    - stig_v_230290
    - nist_ia_5
    - nist_sc_12
    - iso_27001_8_24
    - secrets
    - security
    - vault

- name: "CIS 5.5.1 | STIG V-230290 | NIST IA-5, SC-28 | Perform Secret Archival Integrity Checks"
  ansible.builtin.include_tasks: archival_integrity.yml
  when: core_secrets_enabled | default(true)
  tags:
    - cis_5_5_1
    - stig_v_230290
    - nist_ia_5
    - nist_sc_28
    - secrets
    - archival
    - forensic
    - integrity
