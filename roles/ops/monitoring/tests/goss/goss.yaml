# =============================================================================
# Audit Event Identifier: DSU-PLY-100215
# Last Updated: 2026-02-28
# =============================================================================
---
# Goss tests for ops/monitoring role
# This role sets up monitoring and metrics collection
#
# Compliance: CIS 4.4.x, STIG V-230660-V-230668, NIST SI-4/CA-7, ISO 27001 ยง12.4
#
# These tests verify:
# - Node Exporter is available (if enabled)
# - SMART monitoring tools are available
# - NVMe tools are available
# - Monitoring services can run

# Command checks
command:
  # Check node_exporter availability
  node_exporter --version:
    exit-status: 0
    stderr: []
    timeout: 10000
    skip: true  # May not be installed

  # Check prometheus-node-exporter availability
  prometheus-node-exporter --version:
    exit-status: 0
    stderr: []
    timeout: 10000
    skip: true  # May not be installed

  # Check smartctl availability
  smartctl --version:
    exit-status: 0
    stderr: []
    timeout: 10000
    skip: true  # May not be installed

  # Check nvme command availability
  nvme --version:
    exit-status: 0
    stderr: []
    timeout: 10000
    skip: true  # May not be installed

# File checks
file:
  # Node Exporter config
  /etc/default/prometheus-node-exporter:
    exists: true
    skip: true

  # SMART config
  /etc/smartd.conf:
    exists: true
    skip: true

  /etc/smartd:
    exists: true
    is-directory: true
    skip: true

# Service checks - these check if services would be able to run
service:
  # Node Exporter service
  node-exporter:
    enabled: true
    running: true
    skip: true  # May not be installed

  prometheus-node-exporter:
    enabled: true
    running: true
    skip: true  # May not be installed

  # SMART monitoring service
  smartd:
    enabled: true
    running: true
    skip: true  # May not be installed

# Package checks
package:
  prometheus-node-exporter:
    installed: true
    skip: true

  node_exporter:
    installed: true
    skip: true

  smartmontools:
    installed: true
    skip: true

  nvme-cli:
    installed: true
    skip: true
