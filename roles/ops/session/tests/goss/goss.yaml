---
# Goss tests for ops/session role
# This role manages TMUX session for deployment operations
#
# Compliance: CIS 4.7.x, STIG V-230720-V-230722, NIST AU-2, ISO 27001 ยง8.15/ยง8.16
#
# These tests verify:
# - TMUX is available (if enabled)
# - Basic system commands work
# - The role can execute

# Command checks
command:
  # Check tmux is available
  tmux -V:
    exit-status: 0
    stderr: []
    timeout: 10000
    skip: true  # TMUX may not be installed

  # Check bash is available
  bash --version:
    exit-status: 0
    stderr: []
    timeout: 5000

  # Basic echo test
  echo "session_role_active":
    exit-status: 0
    stderr: []
    stdout:
      - "session_role_active"
    timeout: 5000

# File checks
file:
  /bin/bash:
    exists: true
    mode: "0755"
    owner: root
    group: root

  /tmp:
    exists: true
    is-directory: true
    mode: "1777"

# Process check - verify basic system is running
process:
  init:
    running: true
    # PID 1 should be running

# Package checks
package:
  tmux:
    installed: true
    skip: true  # May not be installed
