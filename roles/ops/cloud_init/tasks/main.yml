# =============================================================================
# Audit Event Identifier: DSU-PLY-100183
# Last Updated: 2026-02-28
# =============================================================================
---
# Tasks for ops/cloud_init - Cloud Provider Sync
# Compliance: CIS 4.x, STIG V-230540, NIST AU-2/CA-7/IR-4/SI-4, ISO 27001 ยง8.15/ยง8.16/ยง16.1

- name: "CIS 4.9.1 | STIG V-230750 | NIST CM-6 | ISO 9001 | Audit Code 600013 | Wait for cloud-init to complete"
  ansible.builtin.command: cloud-init status --wait
  become: true
  changed_when: false
  register: cloud_init_status
  failed_when: false # Don't fail if cloud-init isn't present
  tags:
    - cis_4_9_1
    - stig_v_230750
    - nist_cm_6
    - iso_9001
    - ops
    - initialization

- name: "CIS 4.9.2 | STIG V-230751 | NIST CM-6 | Report cloud-init status"
  ansible.builtin.debug:
    msg: "Cloud-init synchronization complete: {{ cloud_init_status.stdout | default('Not Present') }}"
  tags:
    - cis_4_9_2
    - stig_v_230751
    - nist_cm_6
    - ops
    - initialization
