# =============================================================================
# Audit Event Identifier: DSU-PLY-100184
# Last Updated: 2026-02-28
# =============================================================================
---
# Goss tests for ops/cloud_init role
# This role handles cloud-init configuration and synchronization
#
# Compliance: CIS 4.9.x, STIG V-230750/V-230751, NIST CM-6, ISO 27001 ยง8.15/ยง8.16
#
# These tests verify:
# - cloud-init is available (if installed)
# - cloud-init can report status
# - The role executed without errors

command:
  # Check if cloud-init is available
  cloud-init --version:
    exit-status: 0
    stderr: []
    timeout: 10000
    skip: true  # May not be installed in all environments

  # Verify cloud-init status command works
  cloud-init status --wait:
    exit-status: 0
    stderr: []
    timeout: 300000
    skip: true  # May timeout or not be available

  # Report cloud-init status
  cloud-init status:
    exit-status: 0
    stderr: []
    timeout: 30000

# File checks for cloud-init configuration
file:
  /etc/cloud/cloud.cfg:
    exists: true
    mode: "0644"
    owner: root
    group: root
    skip: true  # May not exist in all environments

# Service checks
service:
  cloud-init:
    enabled: true
    running: true
    skip: true  # May not be available in all environments

# Package checks
package:
  cloud-init:
    installed: true
    skip: true  # May not be installed in all environments
