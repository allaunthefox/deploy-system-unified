{# =============================================================================
# Audit Event Identifier: DSU-TPL-900027
# Template Type: vault_integration Configuration
# Last Updated: 2026-02-28
# Version: 1.0
# ============================================================================= #}
# HashiCorp Vault Configuration
# Managed by Ansible - DO NOT EDIT MANUALLY

{% if vault_install_mode == 'standalone' %}
# Storage backend
storage "file" {
  path = "{{ vault_data_dir }}"
}

# Listener configuration
listener "tcp" {
  address     = "127.0.0.1:8200"
  cluster_address = "127.0.0.1:8201"
  tls_disable = true
}

# API address
api_addr = "http://127.0.0.1:8200"

# Cluster address
cluster_addr = "http://127.0.0.1:8201"

# Disable mlock
disable_mlock = true

# Telemetry
telemetry {
  prometheus_retention_time = "30s"
  disable = false
}

# Log level
log_level = "{{ vault_log_level | default('info') }}"

# Vault data directory
data_dir = "{{ vault_data_dir }}"

# Auto-unseal configuration (NIST SP 800-53 SC-28)
{% if vault_auto_unseal_enabled | bool %}
seal "{{ vault_auto_unseal_type }}" {
  {% if vault_auto_unseal_type == 'transit' %}
  address         = "{{ vault_auto_unseal_transit_address }}"
  disable_renewal = "false"
  key_name        = "{{ vault_auto_unseal_transit_key_name }}"
  mount_path      = "{{ vault_auto_unseal_transit_mount_path }}"
  token           = "{{ vault_auto_unseal_transit_token }}"
  {% elif vault_auto_unseal_type == 'gcpckms' %}
  project     = "{{ vault_auto_unseal_gcp_project }}"
  region      = "{{ vault_auto_unseal_gcp_region }}"
  key_ring    = "{{ vault_auto_unseal_gcp_key_ring }}"
  crypto_key  = "{{ vault_auto_unseal_gcp_crypto_key }}"
  {% endif %}
}
{% endif %}
{% endif %}

# Enable Kubernetes auth if configured
{% if vault_enable_k8s_auth %}
# Kubernetes auth is enabled via CLI
{% endif %}

# Enable KV secrets if configured
{% if vault_enable_kv_secrets %}
# KV v2 secrets engine is enabled via CLI
{% endif %}
