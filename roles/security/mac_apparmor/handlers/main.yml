# =============================================================================
# Audit Event Identifier: DSU-PLY-100346
# Last Updated: 2026-02-28
# =============================================================================
---
# NIST SP 800-53 | ISO 27001 ยง14.2
# Handlers for security/mac_apparmor - Mandatory Access Control

- name: Reload apparmor profiles
  ansible.builtin.command: apparmor_parser -r /etc/apparmor.d/*
  become: true
  failed_when: false
  changed_when: false

- name: Restart apparmor service
  ansible.builtin.service:
    name: apparmor
    state: restarted
  become: true
  when: ansible_os_family in ['Debian', 'Alpine']

- name: Reconfigure apparmor
  ansible.builtin.command: aa-enforce /etc/apparmor.d/*
  become: true
  failed_when: false
  changed_when: false
  when: not (is_virtualized | default(false))
