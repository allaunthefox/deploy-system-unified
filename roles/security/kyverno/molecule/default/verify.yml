# =============================================================================
# Audit Event Identifier: DSU-TST-1003055
# Test Type: Molecule Verify Phase
# Last Updated: 2026-02-28
# Version: 1.0
# =============================================================================
---
# NIST SP 800-53 | ISO 27001 ยง14.2
- name: Verify
  hosts: all
  tasks:
    - name: Check if Default Deny Policy was created
      kubernetes.core.k8s_info:
        api_version: kyverno.io/v1
        kind: ClusterPolicy
        name: generate-default-deny-network-policy
      register: policy
      environment:
        KUBECONFIG: /etc/rancher/k3s/k3s.yaml
    - name: Assert policy exists
      ansible.builtin.assert:
        that:
          - policy.resources | length > 0
