---
# Directory verification for Deploy-System-Unified
- name: "ISO 27001 ยง8.9 | Audit Code 520010 | Verify all required directories exist (idempotent)"
  ansible.builtin.stat:
    path: "{{ item }}"
  register: dir_check
  loop:
    - /var/lib/deploy-system
    - /var/lib/deploy-system/checkpoints
    - /var/lib/deploy-system/backups
    - /var/lib/deploy-system/logs
    - /etc/firejail
    - /srv/containers
    - /srv/containers/config
    - /srv/containers/data
    - /srv/containers/secrets
  tags:
    - iso27001
    - security
    - scanning

- name: Validate directory permissions (idempotent)
  ansible.builtin.assert:
    that:
      - item.stat.exists
      - item.stat.isdir
    fail_msg: "Directory {{ item.item }} does not exist or is not a directory"
  loop: "{{ dir_check.results }}"
  tags:
    - security
    - scanning
