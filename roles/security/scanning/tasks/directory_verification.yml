---
# Directory verification for Deploy-System-Unified
- name: Verify all required directories exist (idempotent)
  ansible.builtin.stat:
    path: "{{ item }}"
  register: dir_check
  loop:
    - /var/lib/deploy-system
    - /var/lib/deploy-system/checkpoints
    - /var/lib/deploy-system/backups
    - /var/lib/deploy-system/logs
    - /etc/firejail
    # - /etc/landlock # Kernel feature, no config dir
    # - /etc/bubblewrap # Utils, no config dir
    # - /etc/chrony # Arch uses /etc/chrony.conf
    # - /etc/trivy
    # - /etc/trufflehog
    # - /etc/checkov
    - /srv/containers
    - /srv/containers/config
    - /srv/containers/data
    - /srv/containers/secrets
- name: Validate directory permissions (idempotent)
  ansible.builtin.assert:
    that:
      - item.stat.exists
      - item.stat.isdir
    fail_msg: "Directory {{ item.item }} does not exist or is not a directory"
  loop: "{{ dir_check.results }}"
