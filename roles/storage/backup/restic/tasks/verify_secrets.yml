# =============================================================================
# Audit Event Identifier: DSU-PLY-100704
# Last Updated: 2026-02-28
# =============================================================================
---
# Verify Restic password when fail-secure is enabled
- name: Assert Restic password is set when fail-secure
  ansible.builtin.assert:
    that:
      - restic_password is defined
      - (restic_password | default('') | length) > 0
    fail_msg: "Restic password is missing or empty. Please configure a secure password in your inventory secrets or set restic_fail_secure=false to bypass."
  when:
    - restic_enable | bool
    - restic_fail_secure | default(true) | bool
  tags:
    - backup
    - restic
    - iso_27040
    - security
