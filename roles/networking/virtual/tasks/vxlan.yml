---
# Tasks for VXLAN management (L3 Overlay)
# Compliance: CIS 3.3.x | STIG V-230400 | NIST SC-7, AC-4 | ISO 27001 ยง8.20, ยง8.21

- name: "CIS 3.3.5 | STIG V-230400 | Ensure VXLAN VTEP interface is defined"
  tags:
    - cis_3_3_5
    - stig_v_230400
    - nist_ac_4
    - iso_27001_8_20
    - networking
    - virtual
    - remediate
  ansible.builtin.debug:
    msg: "VXLAN (VNI {{ item.vni | default('10') }}) is being established on port 4789."
  loop: "{{ virt_net_vxlan_interfaces | default([]) }}"

- name: "CIS 3.3.6 | STIG V-230400 | Configure VXLAN kernel readiness"
  tags:
    - cis_3_3_6
    - stig_v_230400
    - nist_sc_7
    - iso_27001_8_21
    - networking
    - virtual
    - remediate
  community.general.modprobe:
    name: vxlan
    state: present
  become: true
