---
# vars/main.yml for vpn_mesh role
# Role-specific internal variables for WireGuard and IPsec VPN mesh
# Compliance: CIS 3.5.x | STIG V-230360, V-230361 | NIST SC-8, SC-12, SC-13 | ISO 27001 ยง8.24, ยง8.28
# NOT meant to be overridden by users

# =============================================================================
# WireGuard Configuration Paths
# =============================================================================
_wireguard_config_dir: /etc/wireguard
_wireguard_private_key_mode: '0600'
_wireguard_public_key_mode: '0644'
_wireguard_config_mode: '0600'

_wireguard_interface_name: wg0
_wireguard_mesh_interface_name: wg-mesh

# WireGuard systemd service names
_wireguard_service_template: wg-quick@.service
_wireguard_service_instance: "wg-quick@{{ _wireguard_interface_name }}"
_wireguard_mesh_service_instance: "wg-quick@{{ _wireguard_mesh_interface_name }}"

# WireGuard default settings
_wireguard_default_port: 51820
_wireguard_default_mtu: 1420
_wireguard_default_persistent_keepalive: 25
_wireguard_listen_port: 51820

# WireGuard kernel module
_wireguard_kernel_module: wireguard
_wireguard_required_sysctls:
  - net.ipv4.ip_forward=1
  - net.ipv6.conf.all.forwarding=1

# =============================================================================
# IPsec/StrongSwan Configuration Paths
# =============================================================================
_ipsec_config_dir: /etc/ipsec.d
_ipsec_certs_dir: /etc/ipsec.d/certs
_ipsec_private_dir: /etc/ipsec.d/private
_ipsec_configs_dir: /etc/ipsec.d/configs
_ipsec_policies_dir: /etc/ipsec.d/policies

# IPsec configuration files
_ipsec_main_config: /etc/ipsec.conf
_ipsec_secrets_file: /etc/ipsec.secrets
_ipsec_connections_dir: /etc/ipsec.d/connections

# IPsec service names (multiple implementations)
_ipsec_services:
  strongswan: strongswan
  strongswan_starter: strongswan-starter
  ipsec: ipsec
  libreswan: libreswan
  pluto: pluto

# IPsec default settings
_ipsec_default_ike_port: 500
_ipsec_default_nat_t_port: 4500
_ipsec_default_esp_proposal: aes256gcm16-prfsha512-ecp384
_ipsec_default_ike_proposal: aes256gcm16-prfsha512-ecp384
_ipsec_default_dh_group: ecp384
_ipsec_default_lifetime: 28800
_ipsec_default_rekey_margin: 3600

# IPsec kernel modules
_ipsec_kernel_modules:
  - af_key
  - xfrm_user
  - esp4
  - esp6
  - ah4
  - ah6

# IPsec connection types
_ipsec_connection_types:
  - tunnel
  - transport
  - passthrough

# =============================================================================
# VPN Mesh Topology
# =============================================================================
_vpn_mesh_protocol: wireguard
_vpn_mesh_default_subnet: 10.100.0.0/16
_vpn_mesh_node_subnet_mask: 24
_vpn_mesh_peer_timeout: 30

# =============================================================================
# Kernel Readiness for Encrypted Traffic
# =============================================================================
_vpn_kernel_modules_path: /proc/sys/kernel/modules_disabled
_vpn_xfrm_state_path: /proc/net/xfrm_stat
_vpn_crypto_path: /proc/crypto

# =============================================================================
# Compliance and Security Tags
# =============================================================================
_vpn_cis_controls:
  - cis_3_5_1   # Detect virtualization environment
  - cis_3_5_2   # Read kernel module lockdown state
  - cis_3_5_3   # Ensure WireGuard kernel module
  - cis_3_5_4   # Verify IPsec/ESP kernel modules
  - cis_3_5_5   # Report encryption readiness

_vpn_stig_controls:
  - stig_v_230360  # VPN - WireGuard kernel module
  - stig_v_230361  # VPN - IPsec/ESP kernel modules

_vpn_nist_controls:
  - nist_sc_7   # Boundary Protection
  - nist_sc_8   # Transmission Confidentiality and Integrity
  - nist_sc_12  # Cryptographic Key Establishment
  - nist_sc_13  # Cryptographic Protection

_vpn_iso_controls:
  - iso_27001_8_24  # Cryptography
  - iso_27001_8_28  # Secure Cryptographic Keys

# =============================================================================
# Compliance Control Descriptions
# =============================================================================
_vpn_compliance_description:
  cis: "CIS Benchmark Section 3.5 - Cryptographic Protocols (VPN/WireGuard)"
  stig: "STIG Network Infrastructure - VPN Encryption Configuration"
  nist: "NIST SP 800-53 SC-8 (Transmission Security), SC-12/13 (Cryptography)"
  iso: "ISO 27001:2022 Annex A 8.24 (Cryptography), 8.28 (Secure Key Management)"
