# =============================================================================
# Audit Event Identifier: DSU-PLY-100901
# Last Updated: 2026-03-01
# =============================================================================
---
# Main tasks for kubernetes/service_mesh
# Compliance: ISO 27001 ยง10.1, NIST SC-7

- name: "ISO 27001 ยง10.1 | 800900 | Check service mesh enablement"
  ansible.builtin.debug:
    msg: "Initializing Service Mesh (Provider: {{ service_mesh_provider }})"
  when: service_mesh_enabled | bool
  tags: [kubernetes, service_mesh, initialization, 800900]

- name: "ISO 9001 | 600013 | Validate service mesh provider"
  ansible.builtin.assert:
    that:
      - service_mesh_provider in ['linkerd', 'kuma']
    fail_msg: "Invalid service_mesh_provider: {{ service_mesh_provider }}. Supported: linkerd, kuma."
  when: service_mesh_enabled | bool
  tags: [kubernetes, service_mesh, verify, 600013]

- name: "ISO 27001 ยง14.2 | 800901 | Include Linkerd specific tasks"
  ansible.builtin.include_tasks: linkerd.yml
  when:
    - service_mesh_enabled | bool
    - service_mesh_provider == 'linkerd'
  tags: [kubernetes, service_mesh, linkerd, deploy, 800901]

- name: "ISO 27001 ยง14.2 | 800902 | Include Kuma specific tasks"
  ansible.builtin.include_tasks: kuma.yml
  when:
    - service_mesh_enabled | bool
    - service_mesh_provider == 'kuma'
  tags: [kubernetes, service_mesh, kuma, deploy, 800902]
