---
# Handlers for gpu_stack

- name: update_initramfs_placeholder
  ansible.builtin.debug:
    msg: "Updating initramfs..."
  listen: "Update initramfs"
  notify:
    - Update Initramfs Debian
    - Update Initramfs RedHat
    - Update Initramfs Alpine
    - Update Initramfs Archlinux


- name: restart_display_manager_placeholder
  ansible.builtin.debug:
    msg: "Would restart Display Manager (gdm/lightdm/sddm) if present."
  listen: "Restart Display Manager (Placeholder)"

- name: update_initramfs_debian
  ansible.builtin.command: update-initramfs -u
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'Debian'
    - not _gpu_is_container | default(false)


- name: update_initramfs_redhat
  ansible.builtin.command: dracut --force
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'RedHat'
    - not _gpu_is_container | default(false)


- name: update_initramfs_alpine
  ansible.builtin.command: mkinitfs
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'Alpine'
    - not _gpu_is_container | default(false)


- name: reload_udev
  ansible.builtin.shell: set -o pipefail && udevadm control --reload-rules && udevadm trigger
  args:
    executable: /bin/bash
  become: true
  changed_when: true
  when: not _gpu_is_container | default(false)


- name: update_initramfs_archlinux
  ansible.builtin.command: mkinitcpio -P
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'Archlinux'
    - not _gpu_is_container | default(false)
