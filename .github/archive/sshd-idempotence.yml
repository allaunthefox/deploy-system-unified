name: SSHD Idempotence Test

on:
  push:
    branches: [ main, 'chore/*' ]
  pull_request:
    branches: [ main ]
  # allow manual execution during CI troubleshooting
  workflow_dispatch: {}

jobs:
  idempotence:
    name: Run idempotence verification in container
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run idempotence test on runner (shared script)
        run: |
          set -euo pipefail
          bash .scripts/run_idempotence.sh
