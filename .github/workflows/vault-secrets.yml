name: HashiCorp Vault Secrets

on:
  workflow_dispatch:
    inputs:
      secret_path:
        description: 'Vault secret path (e.g., secret/data/deploy/prod)'
        required: true
        default: 'secret/data/deploy/prod'

jobs:
  vault-secrets:
    name: Fetch Vault Secrets
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Retrieve Vault Secrets
        id: secrets
        uses: hashicorp/vault-action@v3.4.0
        with:
          url: ${{ vars.VAULT_ADDR }}
          namespace: ${{ vars.VAULT_NAMESPACE }}
          method: token
          token: ${{ secrets.VAULT_TOKEN }}
          secrets: |
            ${{ inputs.secret_path }} AWS_ACCESS_KEY_ID | AWS_ACCESS_KEY_ID;
            ${{ inputs.secret_path }} AWS_SECRET_ACCESS_KEY | AWS_SECRET_ACCESS_KEY;
            ${{ inputs.secret_path }} DEPLOY_PASSWORD | DEPLOY_PASSWORD

      - name: Deploy (Example)
        env:
          AWS_ACCESS_KEY_ID: ${{ steps.secrets.outputs.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ steps.secrets.outputs.AWS_SECRET_ACCESS_KEY }}
          DEPLOY_PASSWORD: ${{ steps.secrets.outputs.DEPLOY_PASSWORD }}
        run: |
          # Your deployment commands here
          echo "Deploying with Vault secrets..."
