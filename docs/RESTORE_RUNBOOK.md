# RESTORE RUNBOOK: Forensic Data Restoration (ISO 27040)

**Reference Code**: 900010 (Restore start)  
**Playbook**: `playbooks/restore_data.yml`  
**Standard**: ISO/IEC 27040:2024 (Storage Security)

---

## ğŸ“– Overview

This runbook describes the procedure for restoring critical service data (Jellyfin, Radarr, Authentik, etc.) from migration assets or backups while maintaining a full forensic audit trail.

---

## ğŸ› ï¸ Prerequisites

1.  **Integrity Manifest**: A valid `hash_manifest.txt` must exist in `/var/backups/security/`.
2.  **Verification Tools**: `sha256sum`, `sha512sum`, and `openssl` must be installed on the control node.
3.  **Migration Assets**: Source data must be present in `{{ playbook_dir }}/../migration_assets`.

---

## ğŸš€ Execution Steps

### 1. Preflight Verification (Code 520030)
Run the playbook in check mode first to verify hash integrity without making changes:

```bash
ansible-playbook playbooks/restore_data.yml --check
```

### 2. Full Restoration (Code 900010)
Execute the restoration on the target host:

```bash
ansible-playbook playbooks/restore_data.yml -i inventory/your_host.ini
```

### 3. Targeted Database Restore
To only restore the PostgreSQL databases (Authentik):

```bash
ansible-playbook playbooks/restore_data.yml --tags database
```

---

## ğŸ” Forensic Verification

Every restoration run generates the following auditable events in the **Loki** stream:

| Action Code | Description | Standard |
|-------------|-------------|----------|
| **560000**  | DB Readiness Verified | ISO 27001 Â§12.4 |
| **560022**  | DB Schema Re-initialized | ISO 27040 |
| **560023**  | SQL Data Imported | ISO 27040 |
| **900010**  | File/Archive Restored | ISO 27040 |
| **600142**  | Permissions Drift Corrected | ISO 27001 Â§8.8 |

---

## ğŸ›‘ Troubleshooting

- **Error 560000 (DB Timeout)**: Ensure the Podman service is running and the database container has finished its internal initialization.
- **Integrity Failure**: If the `hash_manifest.txt` does not match the source files, the playbook will fail-fast before any data is copied. **Do not bypass this check.**

---

*Generated by DSU Runbook Creator*
*Last Updated: February 2026*
