# Network Topology: Data Flow & Isolation

This diagram visualizes the traffic flow from the public internet through the **Deploy-System-Unified** security layers to the backend services.

```mermaid
graph TD
    User((Public User)) -->|Port 443| Caddy[Layer 5: Caddy Ingress]
    
    subgraph "Edge Hardening"
        Caddy -->|Forward Auth| Auth{Layer 2: Authentik}
        Auth -->|Challenge/Login| Caddy
    end

    subgraph "AI Shield"
        Caddy -.->|Validation Proxy| Anubis[Anubis AI Firewall]
        Anubis -.->|Proof-of-Work| Caddy
    end

    subgraph "Internal Isolated Networks"
        Caddy -->|L3 Bridge| MediaNet[[media_net]]
        Caddy -->|L3 Bridge| OpsNet[[ops_net]]
        
        subgraph "Media Stack"
            MediaNet --> Radarr[Radarr]
            MediaNet --> Sonarr[Sonarr]
            MediaNet --> Jellyfin[Jellyfin]
        end

        subgraph "Ops Stack"
            OpsNet --> Vault[Vaultwarden]
            OpsNet --> Homarr[Homarr]
        end
    end

    subgraph "Forensic Aggregation"
        Caddy -->|Action Code 540001| Loki[(Loki)]
        Auth -->|Action Code 400004| Loki
        Anubis -->|Action Code 460000| Loki
    end

    style Caddy fill:#f96,stroke:#333,stroke-width:2px
    style Anubis fill:#f55,stroke:#333
    style MediaNet fill:#dfd,stroke:#333,stroke-dasharray: 5 5
    style OpsNet fill:#dfd,stroke:#333,stroke-dasharray: 5 5
    style Loki fill:#bbf,stroke:#333,stroke-width:4px
```

---

## ðŸ”’ Security Posture Analysis

1.  **Strict Ingress**: Only Caddy (Port 443) is exposed to the host/internet.
2.  **Internal Isolation**: Backends (Radarr, Sonarr, etc.) have NO direct host ports. They communicate only via internal bridge networks.
3.  **Forward-Auth**: No request reaches a backend unless Authentik verifies the session headers.
4.  **Forensic Trail**: Every transition between networks is logged via Action Codes to Loki.

*Generated by DSU Architecture Creator*  
*Standard: NIST SC-7 (Boundary Protection)*
