---
pipeline:
  style-enforcement:
    image: ubuntu:latest
    commands:
      - apt-get update && apt-get install -y git python3 python3-pip
      - pip3 install ansible-lint detect-secrets
      - chmod +x projects/deploy-system-unified/dev_tools/tools/style-guide-enforcement/enforce_style_guide.sh
      - ./projects/deploy-system-unified/dev_tools/tools/style-guide-enforcement/enforce_style_guide.sh --report

  detect-secrets:
    image: ubuntu:latest
    commands:
      - apt-get update && apt-get install -y git python3 python3-pip jq
      - pip3 install detect-secrets==1.3.0
      - detect-secrets scan --all-files --json > .secrets_scan.json || true
      - if [ -s .secrets_scan.json ]; then jq '.results | length' .secrets_scan.json; fi

  ansible-lint:
    image: ubuntu:latest
    commands:
      - apt-get update && apt-get install -y git python3 python3-pip
      - pip3 install ansible-lint
      - cd projects/deploy-system-unified && ansible-lint -v -c .ansible-lint.yml -r ansiblelint/rules main.yml

branches: [main, 'ci/**']
