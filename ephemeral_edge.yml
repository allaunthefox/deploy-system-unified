# =============================================================================
# Audit Event Identifier: DSU-PLY-100008
# Playbook Type: Ephemeral Edge Deployment
# Description: Secure, volatile ingress for temporary workloads (Caddy + Anubis)
# Profile: Ephemeral with volatile secrets
# Last Updated: 2026-02-28
# Version: 1.0
# =============================================================================
---
# Ephemeral Edge Deployment - Caddy + Anubis
# Scenario: Secure, volatile ingress for temporary workloads

- name: Initialize Ephemeral Identity
  hosts: all
  gather_facts: true
  roles:
    - core/identity
    - core/hardware_support

- name: Provision Edge Infrastructure
  hosts: all
  become: true
  vars:
    # Ephemeral Overrides
    deployment_profile: "ephemeral"
    ephemeral_volatile_secrets: true
    caddy_generate_config: true
    anubis_enabled: true
    
    # Supply Chain Verification (Unblocking Test)
    containers_cosign_enable: true
    cosign_checksums:
      "v2.2.3":
        "amd64": "sha256:9a1e2d3f4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e"
        "arm64": "sha256:1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c"
    
  roles:
    - containers/runtime
    - containers/caddy
    - containers/anubis

  post_tasks:
    - name: "ISO 27001 ยง12.4 | 300014 | Verify Ephemeral Edge Arrival"
      ansible.builtin.debug:
        msg: "DEPLOYMENT SUCCESSFUL | Host: {{ inventory_hostname }} | UUID: {{ object_uuid }} | Posture: {{ deployment_profile }}"
