# =============================================================================
# Audit Event Identifier: DSU-TST-1000005
# File Type: Molecule Scenario Configuration
# Scenario: gpu_slicing
# Last Updated: 2026-02-28
# Version: 1.0
# =============================================================================
---
# molecule.yml - Ansible-Native Molecule configuration for gpu_slicing scenario
#
# This configuration uses the ansible-native approach which gives full control
# over the testing lifecycle through custom create/destroy playbooks.
#
# This scenario tests GPU slicing, so it requires special device mappings:
#   - /dev/dri:/dev/dri for GPU access
#   - CAP_SYS_ADMIN capability
#
# Key sections:
#   - ansible.executor: Defines how playbooks are executed
#   - ansible.env: Environment variables for Ansible
#   - ansible.cfg: Ansible configuration options
#   - ansible.playbooks: Paths to create/destroy/converge/verify playbooks
#   - scenario.test_sequence: Order of test execution
#   - verifier: Verification backend (ansible-native uses ansible)
#
# Example:
#     molecule test -s gpu_slicing

ansible:
  executor:
    backend: ansible-playbook
    args:
      ansible_playbook:
        - --inventory=inventory/
  env:
    ANSIBLE_FORCE_COLOR: true
    ANSIBLE_ROLES_PATH: ${MOLECULE_PROJECT_DIRECTORY}/roles
    ANSIBLE_REMOTE_TEMP: /tmp/ansible
    
  cfg:
    defaults:
      deprecation_warnings: false
      interpreter_python: auto_silent
      host_key_checking: true
      allow_broken_conditionals: true

  playbooks:
    create: create.yml
    destroy: destroy.yml
    converge: converge.yml
    prepare: prepare.yml
    verify: verify.yml

scenario:
  test_sequence:
    - create
    - prepare
    - converge
    - idempotence
    - verify
    - destroy

verifier:
  name: ansible
