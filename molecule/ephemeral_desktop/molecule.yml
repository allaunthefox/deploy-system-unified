# =============================================================================
# Audit Event Identifier: DSU-TST-1000004
# File Type: Molecule Scenario Configuration
# Scenario: ephemeral_desktop
# Last Updated: 2026-02-28
# Version: 1.0
# =============================================================================
---
# molecule.yml - Ansible-Native Molecule configuration for ephemeral_desktop scenario
#
# This configuration uses the ansible-native approach which gives full control
# over the testing lifecycle through custom create/destroy playbooks.
#
# This scenario tests ephemeral desktop functionality with systemd:
#   - geerlingguy/docker-ubuntu2204-ansible image
#   - systemd support via /lib/systemd/systemd
#   - cgroupns_mode: host for systemd
#
# Key sections:
#   - ansible.executor: Defines how playbooks are executed
#   - ansible.env: Environment variables for Ansible
#   - ansible.cfg: Ansible configuration options
#   - ansible.playbooks: Paths to create/destroy/converge/verify playbooks
#   - scenario.test_sequence: Order of test execution
#   - verifier: Verification backend (ansible-native uses ansible)
#
# Example:
#     molecule test -s ephemeral_desktop

ansible:
  executor:
    backend: ansible-playbook
    args:
      ansible_playbook:
        - --inventory=inventory/
  env:
    ANSIBLE_FORCE_COLOR: true
    ANSIBLE_ROLES_PATH: ${MOLECULE_PROJECT_DIRECTORY}/roles
    
  cfg:
    defaults:
      deprecation_warnings: false
      interpreter_python: auto_silent
      host_key_checking: true
      allow_broken_conditionals: true

  playbooks:
    create: create.yml
    destroy: destroy.yml
    converge: converge.yml
    prepare: prepare.yml
    verify: verify.yml
    cleanup: ${MOLECULE_PROJECT_DIRECTORY}/molecule/_shared/cleanup.yml
    side_effect: ${MOLECULE_PROJECT_DIRECTORY}/molecule/_shared/side_effect.yml

scenario:
  test_sequence:
    - create
    - prepare
    - converge
    - idempotence
    - verify
    - cleanup
    - destroy

verifier:
  name: ansible
