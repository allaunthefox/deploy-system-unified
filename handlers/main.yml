---
# Global Shared Handlers for Deploy-System-Unified

- name: reload_systemd
  ansible.builtin.systemd:
    daemon_reload: true
  become: true
  listen: "reload_systemd"

- name: restart_journald
  ansible.builtin.service:
    name: systemd-journald
    state: restarted
  listen: "restart_journald"

- name: update-grub
  ansible.builtin.command: /usr/bin/update-grub
  become: true
  failed_when: false
  changed_when: true
  listen: "update-grub"

# Alternative: grub-mkconfig for non-Debian systems
- name: grub-mkconfig
  ansible.builtin.command: /usr/sbin/grub-mkconfig -o /boot/grub/grub.cfg
  become: true
  failed_when: false
  changed_when: true
  listen: "grub-mkconfig"

# Caddy Handler (reachable from include_role scopes)
- name: restart_caddy
  ansible.builtin.systemd:
    name: caddy
    state: restarted
    enabled: true
  become: true
  listen: "restart_caddy"

# Firewall Handler (for SSH port changes)
- name: save_firewall_rules
  ansible.builtin.command: /sbin/iptables-save > /etc/iptables/rules.v4
  become: true
  listen: "save_firewall_rules"
