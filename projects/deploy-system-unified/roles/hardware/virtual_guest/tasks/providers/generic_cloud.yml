---
# Tasks for Generic Cloud VPS optimization
# Based on research: Prevents the "Fragmentation Trap" in virtualized tunnels
- name: Detect and Standardize Cloud MTU
  ansible.builtin.shell: |
    # Find primary interface and set safe MTU for cloud tunneling
    PRIMARY_IF=$(ip route | grep default | awk '{print $5}' | head -n 1)
    if [ -n "$PRIMARY_IF" ]; then
      ip link set dev "$PRIMARY_IF" mtu 1450
    fi
  become: true
  changed_when: false
  failed_when: false
  args:
    pipefail: true
