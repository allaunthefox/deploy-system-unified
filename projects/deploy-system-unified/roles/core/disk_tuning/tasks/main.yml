---
# Tasks for core/disk_tuning - Physical Storage Optimization
- name: Enable SSD TRIM timer (FSTRIM)
  ansible.builtin.systemd:
    name: fstrim.timer
    enabled: true
    state: started
  become: true
  ignore_errors: true
- name: Set I/O scheduler for physical disks (mq-deadline)
  ansible.builtin.copy:
    content: |
      # Set mq-deadline for non-rotational disks
      ACTION=="add|change", KERNEL=="sd[a-z]*|nvme[0-9]*", ATTR{queue/rotational}=="0", ATTR{queue/scheduler}="mq-deadline"
    dest: /etc/udev/rules.d/60-disk-scheduler.rules
    mode: '0644'
  become: true
  notify: reload udev
