---
# Verify Restic password when fail-secure is enabled
- name: Assert Restic password is not default
  ansible.builtin.assert:
    that:
      - restic_password is defined
      - (restic_password | default('')) != "CHANGE_ME_IN_VAULT"
      - (restic_password | default('') | length) > 0
    fail_msg: "Restic password is set to default 'CHANGE_ME_IN_VAULT' or missing. Please configure a secure password in your inventory secrets or set restic_fail_secure=false to bypass."
  when:
    - restic_enable | bool
    - restic_fail_secure | default(true) | bool
