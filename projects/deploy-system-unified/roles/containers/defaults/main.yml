---
# Defaults for containers role
containers_install_podman: true
caddy_generate_config: true
quadlet_create_network: true

# Rootless Podman Support
containers_podman_rootless_enabled: "{{ podman_rootless_enabled | default(false) }}"
containers_podman_rootless_user: "{{ podman_rootless_user | default(ansible_user | default('prod')) }}"
containers_podman_rootless_user_home: "{{ podman_rootless_user_home | default('/home/' ~ containers_podman_rootless_user) }}"
containers_podman_rootless_network_mode: "{{ podman_rootless_network_mode | default('slirp4netns') }}"
containers_podman_rootless_allow_privileged_ports: "{{ podman_rootless_allow_privileged_ports | default(false) }}"
containers_podman_rootless_privileged_port_start: "{{ podman_rootless_privileged_port_start | default(1024) }}"

containers_systemd_dir: >-
  {{ containers_podman_rootless_enabled | bool
     | ternary(containers_podman_rootless_user_home ~ '/.config/containers/systemd',
               '/etc/containers/systemd') }}
containers_systemd_scope: "{{ containers_podman_rootless_enabled | bool | ternary('user', 'system') }}"
containers_systemd_owner: "{{ containers_podman_rootless_enabled | bool | ternary(containers_podman_rootless_user, 'root') }}"
containers_systemd_group: "{{ containers_podman_rootless_enabled | bool | ternary(containers_podman_rootless_user, 'root') }}"
containers_secrets_dir: >-
  {{ containers_podman_rootless_enabled | bool
     | ternary(containers_podman_rootless_user_home ~ '/.config/containers/secrets',
               '/etc/containers/secrets') }}
containers_secrets_owner: "{{ containers_podman_rootless_enabled | bool | ternary(containers_podman_rootless_user, 'root') }}"
containers_secrets_group: "{{ containers_podman_rootless_enabled | bool | ternary(containers_podman_rootless_user, 'root') }}"
containers_systemd_env: {}

# Policy: warn on weak/default credentials (non-CHANGE_ME) during container deploys
containers_default_password_checks:
  # External-facing stack warnings (weak/default creds that are not placeholders)
  - name: "transmission_user"
    value: "{{ transmission_user | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ transmission_enable | default(false) }}"
  - name: "transmission_pass"
    value: "{{ transmission_pass | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ transmission_enable | default(false) }}"
  - name: "monitoring_grafana_admin_password"
    value: "{{ monitoring_grafana_admin_password | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ monitoring_enable | default(false) }}"
  - name: "authentik_email_password"
    value: "{{ authentik_email_password | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ authentik_enable | default(false) }}"
  - name: "vaultwarden_admin_token"
    value: "{{ vaultwarden_admin_token | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ vaultwarden_enable | default(false) }}"
  - name: "authentik_email_password"
    value: "{{ authentik_email_password | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ authentik_enable | default(false) }}"

containers_linger_users: "{{ containers_podman_rootless_enabled | bool | ternary([containers_podman_rootless_user], []) }}"
