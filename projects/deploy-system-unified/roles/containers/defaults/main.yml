---
# Defaults for containers role
containers_install_podman: true
caddy_generate_config: true
quadlet_create_network: true

# Rootless Podman Support
podman_rootless_enabled: false
podman_rootless_user: "{{ ansible_user | default('prod') }}"
podman_rootless_user_home: "/home/{{ podman_rootless_user }}"
podman_rootless_network_mode: "slirp4netns"
podman_rootless_allow_privileged_ports: false
podman_rootless_privileged_port_start: 1024

containers_systemd_dir: >-
  {{ podman_rootless_enabled | bool
     | ternary(podman_rootless_user_home ~ '/.config/containers/systemd',
               '/etc/containers/systemd') }}
containers_systemd_scope: "{{ podman_rootless_enabled | bool | ternary('user', 'system') }}"
containers_systemd_owner: "{{ podman_rootless_enabled | bool | ternary(podman_rootless_user, 'root') }}"
containers_systemd_group: "{{ podman_rootless_enabled | bool | ternary(podman_rootless_user, 'root') }}"
containers_secrets_dir: >-
  {{ podman_rootless_enabled | bool
     | ternary(podman_rootless_user_home ~ '/.config/containers/secrets',
               '/etc/containers/secrets') }}
containers_secrets_owner: "{{ podman_rootless_enabled | bool | ternary(podman_rootless_user, 'root') }}"
containers_secrets_group: "{{ podman_rootless_enabled | bool | ternary(podman_rootless_user, 'root') }}"
containers_systemd_env: {}

# Policy: warn on weak/default credentials (non-CHANGE_ME) during container deploys
containers_default_password_checks:
  - name: "transmission_user"
    value: "{{ transmission_user | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ transmission_enable | default(false) }}"
  - name: "transmission_pass"
    value: "{{ transmission_pass | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ transmission_enable | default(false) }}"
  - name: "monitoring_grafana_admin_password"
    value: "{{ monitoring_grafana_admin_password | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ monitoring_enable | default(false) }}"
  - name: "authentik_email_password"
    value: "{{ authentik_email_password | default('') }}"
    bad_values: ["admin", "password", "admin123", "root", "changeme"]
    enabled: "{{ authentik_enable | default(false) }}"

container_linger_users: "{{ podman_rootless_enabled | bool | ternary([podman_rootless_user], []) }}"
