# AMD GPU SR-IOV Configuration
# This file is automatically generated by Ansible

# Enable SR-IOV on AMD GPU
options amdgpu sriov_numvfs={{ containers_gpu_slicing.sriov.vf_count }}
options amdgpu sriov_pf_link=true
options amdgpu sriov_queue_depth=128

# PCIe device configuration
{% if containers_gpu_slicing.sriov.pf_device is defined and containers_gpu_slicing.sriov.pf_device %}
# Physical function device
pci=realloc=on,assign-busses

# Virtual function configuration for {{ containers_gpu_slicing.sriov.pf_device }}
{% for i in range(containers_gpu_slicing.sriov.vf_count) %}
vf{{ i }} {
  enabled = true
  memory = "512M"
  compute_units = 4
}
{% endfor %}
{% endif %}