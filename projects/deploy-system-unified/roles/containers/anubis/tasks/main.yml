---
# Tasks for containers/anubis - Web AI Firewall
- name: Create Anubis container quadlet
  ansible.builtin.copy:
    dest: /etc/containers/systemd/anubis.container
    content: |
      [Unit]
      Description=Anubis Web AI Firewall
      After=network-online.target
      Wants=network-online.target
      [Container]
      Image={{ anubis_image }}
      ContainerName={{ anubis_container_name }}
      PublishPort={{ anubis_port }}:8080
      Environment=PORT=8080
      Environment=TARGET={{ anubis_target_url }}
      Environment=DIFFICULTY={{ anubis_difficulty }}
      [Service]
      Restart=always
      TimeoutStartSec=300
      [Install]
      WantedBy=multi-user.target default.target
    mode: '0644'
  become: true
  notify:
    - reload systemd
    - restart anubis
  when: anubis_enabled | bool
- name: Enable and start Anubis service
  ansible.builtin.systemd:
    name: anubis
    enabled: true
    state: started
  become: true
  when: anubis_enabled | bool
