---
# Handlers for containers/anubis
- name: restart anubis (if systemd is available)
  ansible.builtin.systemd:
    name: anubis
    state: restarted
  become: true
  listen: "restart anubis"
  when: ansible_service_mgr == "systemd" and ansible_facts['service_mgr'] == "systemd" and (ansible_facts['os_family'] != 'Container' or '/run/systemd/system' in ansible_facts['mounts'] | map(attribute='mount') | list)
  failed_when: false  # Ignore failures if systemd isn't available
- name: reload systemd (if systemd is available)
  ansible.builtin.systemd:
    daemon_reload: true
  become: true
  listen: "reload systemd"
  when: ansible_service_mgr == "systemd" and ansible_facts['service_mgr'] == "systemd" and (ansible_facts['os_family'] != 'Container' or '/run/systemd/system' in ansible_facts['mounts'] | map(attribute='mount') | list)
  failed_when: false  # Ignore failures if systemd isn't available
