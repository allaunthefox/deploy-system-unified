---
# Verify Media stack secrets when fail-secure is enabled
- name: Assert Transmission credentials are not default
  ansible.builtin.assert:
    that:
      - containers_transmission_user is defined
      - containers_transmission_user != "CHANGE_ME_IN_SOPS"
      - containers_transmission_pass is defined
      - containers_transmission_pass != "CHANGE_ME_IN_SOPS"
      - (containers_transmission_user | default('') | length) > 0
      - (containers_transmission_pass | default('') | length) > 0
    fail_msg: "Transmission credentials are default or missing. Set transmission_user and transmission_pass securely or set containers_media_fail_secure=false to bypass."
  when:
    - containers_transmission_enable | default(true) | bool
    - containers_media_fail_secure | default(true) | bool

# Add other per-service checks as required for Servarr/Arrs (placeholder detection via policy_change_me is still used)