---
# Tasks for security/sandboxing - User-space Isolation
- name: Install Bubblewrap
  ansible.builtin.package:
    name: bubblewrap
    state: present
  become: true

- name: Verify Landlock support in Kernel
  ansible.builtin.shell: |
    set -o pipefail
    dmesg | grep -i landlock || [ -c /dev/landlock ]
  register: landlock_check
  failed_when: false
  changed_when: false
  become: true

- name: Report Landlock status
  ansible.builtin.debug:
    msg: "Landlock Kernel support detected and available for application sandboxing"
  when: landlock_check.rc == 0

- name: Create standard Landlock/Bwrap policy directory
  ansible.builtin.file:
    path: /etc/sandboxing/policies
    state: directory
    mode: '0755'
    owner: root
    group: root
  become: true
