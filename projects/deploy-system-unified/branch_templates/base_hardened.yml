---
# Base Hardened Infrastructure - The Secure Foundation
# This playbook handles all core system setup and security hardening.

- name: Apply Secure Infrastructure Base
  hosts: all
  become: true
  roles:
    # Operations Pre-Flight (Controller-side)
    - role: ops/pre_connection

    # Core system setup (The Foundational Base)
    - role: core/repositories
    - role: core/updates
    - role: core/bootstrap
    - role: core/logging
    - role: security/audit_integrity
    - role: core/time
    - role: core/entropy
    - role: core/secrets

    # Security Baseline (Establish Default-Deny First)
    - role: security/firewall
    - role: security/mac_apparmor
    - role: security/kernel
    - role: security/hardware_isolation
    - role: security/hardening
    - role: security/access
      access_sshd_port: "{{ access_sshd_port | default(22) }}"
    - role: security/file_integrity

    # Advanced Security & Isolation Measures
    - role: security/sandboxing
    - role: security/firejail
    - role: security/resource_protection
    - role: security/network_segmentation
    - role: security/inter_pod_encryption
    - role: security/endlessh
    - role: security/ips
    - role: security/advanced

    # Operations Utilities
    - role: ops/session
    - role: ops/connection_info
