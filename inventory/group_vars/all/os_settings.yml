# =============================================================================
# Audit Event Identifier: DSU-INV-700007
# Last Updated: 2026-02-28
# =============================================================================
---
# Global OS Configuration Settings
# Centralized control for System Defaults, Packages, and Network policies.

# -----------------------------------------------------------------------------
# System Identity & Localization
# -----------------------------------------------------------------------------
system_timezone: "UTC"
system_locale: "en_US.UTF-8"
system_keyboard_layout: "us"

# -----------------------------------------------------------------------------
# Administrative Access (SSH & Users)
# -----------------------------------------------------------------------------
# These settings cascade to roles/security/sshd and roles/core/identity
system_admin_user: "admin"
system_admin_shell: "/bin/bash"

# SSH Port Logic:
# If Endlessh (SSH Tarpit) is enabled, it takes precedence on port 22.
# The real SSHD service moves to 2222 automatically.
# Otherwise, SSHD runs on port 22 (or whatever is defined).
system_enable_endlessh: false
system_ssh_port: "{{ 2222 if system_enable_endlessh | default(false) else 22 }}"
# Effective SSH port (single source of truth for roles). If randomization is
# enabled, the randomized port takes precedence at runtime.
ssh_effective_port: "{{ advanced_security_hardening_random_ssh_port | default(system_ssh_port) | default(22) }}"
ssh_service_name: "{{ 'ssh' if ((ansible_facts | default({})).get('os_family', '') == 'Debian') else 'sshd' }}"

system_ssh_permit_root_login: false   # Global override for security
# Post-Quantum Cryptography (PQC)
# Enables hybrid quantum-resistant key exchanges (ML-KEM, sntrup761)
system_ssh_pqc_enabled: true

# -----------------------------------------------------------------------------
# Networking
# -----------------------------------------------------------------------------
system_enable_ipv6: false
system_dns_servers:
  - "1.1.1.1"
  - "8.8.8.8"

# Internal Networking Policy (ISO 27001 ยง13.1)
# - Prefer static internal ranges (RFC 1918) to avoid loopback inaccuracies.
# - DO NOT rely on localhost/127.0.0.1 for inter-service or container benchmarks.
# - Preferred ranges: 10.0.0.0/8 and 172.16.0.0/12.
system_network_internal_range: "10.0.0.0/8,172.16.0.0/12"
system_network_preferred_dynamic_range: "10.42.0.0/16"
system_network_avoid_localhost: true

# -----------------------------------------------------------------------------
# Package Management (Bootstrap)
# -----------------------------------------------------------------------------
# There packages are installed on ALL systems during the bootstrap phase.
system_base_packages:
  common:
    - sudo
    - curl
    - wget
    - ca-certificates
  # Distro-specific additions (merged with common)
  Debian:
    - gnupg
    - apt-transport-https
    - software-properties-common
  RedHat:
    - gnupg2
    # epel-release is typically needed but let's keep it minimal for bootstrap
  Archlinux:
    - gnupg
  Alpine:
    - gnupg

# -----------------------------------------------------------------------------
# Directory Structure
# -----------------------------------------------------------------------------
system_standard_directories:
  - /usr/local/bin
  - /usr/local/sbin
  - /opt

# -----------------------------------------------------------------------------
# Hardware & Kernel Profile (overrides roles/security/kernel)
# -----------------------------------------------------------------------------
# kernel_profile: "generic"    # 'generic' (VM/Container friendly) or 'bare_metal'
# kernel_enable_iommu: true    # Enable IOMMU/VT-d
# kernel_restrict_dma: true    # Enable DMA protection

# -----------------------------------------------------------------------------
# Deployment Profile (Least-Privilege Defaults)
# -----------------------------------------------------------------------------
# Profiles: ephemeral | workstation | dev | vps | hardened | production | backup
# Use the most restrictive valid profile for the target.
deployment_profile: "hardened"

# -----------------------------------------------------------------------------
# Transfer Protocol Defaults (Explicit Allow)
# -----------------------------------------------------------------------------
# NFS: disabled unless explicitly enabled AND allowlist defined
storage_nfs_enable: false
storage_nfs_exports: []
storage_nfs_mounts: []
# Extra guard: ephemeral profiles must explicitly opt in
storage_nfs_ephemeral_allow: false
# Extra guard: broad exports must be explicitly allowed
storage_nfs_allow_broad_exports: false

# Rsync over SSH: disabled unless explicitly enabled AND allowlist defined
ops_rsync_enable: false
ops_rsync_allowlist: []
# Extra guard: ephemeral profiles must explicitly opt in
ops_rsync_ephemeral_allow: false

# -----------------------------------------------------------------------------
# Observability & Forensic Intelligence
# -----------------------------------------------------------------------------
# Enables centralized log aggregation and forensic dashboards.
# Uses Loki/Promtail for Audit Event Identifier traceability.
system_monitoring_forensics_enabled: true
system_monitoring_loki_enabled: true
system_monitoring_dashboard_forensic: true

# Storage & Archival (NoDupeLabs Standards)
# Extra guard: ephemeral profiles must explicitly opt in
system_storage_archival_ephemeral_allow: false
# Extra guard: security scans in ephemeral must explicitly opt in
system_security_scanning_ephemeral_allow: false
# Extra guard: IPS in ephemeral must explicitly opt in
system_security_ips_ephemeral_allow: false

# -----------------------------------------------------------------------------
# Supply Chain Security (ISO 27001 ยง14.2)
# -----------------------------------------------------------------------------
# Enables mandatory signature verification for container images via Cosign.
system_container_cosign_verify: true


# Extra guard: hardened profiles require integrity verification (ISO 27040 ยง13)
system_storage_hardened_integrity_mandatory: true

# Enables offline Btrfs deduplication (weekly scan)
# Strict Logic: False in ephemeral, Optional in dev/vps, Recommended in hardened/prod.
system_storage_dedupe_btrfs: >-
  {{ true if (deployment_profile | default('hardened') in ['hardened', 'production']) else false }}

# Enables Restic archival grade compression (max)
system_storage_restic_archival: >-
  {{ true if (deployment_profile | default('hardened') in ['hardened', 'production']) else false }}
