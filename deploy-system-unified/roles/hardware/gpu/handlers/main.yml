---
# Handlers for gpu_stack

- name: Update initramfs (placeholder)
  ansible.builtin.debug:
    msg: "Updating initramfs..."
  listen: "Update initramfs"
  notify:
    - Update Initramfs Debian
    - Update Initramfs RedHat
    - Update Initramfs Alpine
    - Update Initramfs Archlinux

- name: Restart Display Manager (Placeholder)
  ansible.builtin.debug:
    msg: "Would restart Display Manager (gdm/lightdm/sddm) if present."
  listen: "Restart Display Manager (Placeholder)"

- name: Update Initramfs Debian
  ansible.builtin.command: update-initramfs -u
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'Debian'
    - not _gpu_is_container | default(false)

- name: Update Initramfs RedHat
  ansible.builtin.command: dracut --force
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'RedHat'
    - not _gpu_is_container | default(false)

- name: Update Initramfs Alpine
  ansible.builtin.command: mkinitfs
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'Alpine'
    - not _gpu_is_container | default(false)

- name: Reload udev
  ansible.builtin.shell: set -o pipefail && udevadm control --reload-rules && udevadm trigger
  args:
    executable: /bin/bash
  become: true
  changed_when: true
  when: not _gpu_is_container | default(false)

- name: Update Initramfs Archlinux
  ansible.builtin.command: mkinitcpio -P
  become: true
  changed_when: true
  when:
    - ansible_facts['os_family'] == 'Archlinux'
    - not _gpu_is_container | default(false)
