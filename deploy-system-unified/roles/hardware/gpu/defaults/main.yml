---
# Defaults for hardware/gpu

# Enable/Disable the role
gpu_stack_enable: false

# GPU Vendor Selection: nvidia, amd, intel, mali, adreno, img, generic
# Can be a string ("nvidia") or a list (["nvidia", "intel"]) for mixed environments.
gpu_stack_vendor: generic

# GPU Mode: server (headless/compute), desktop (graphics/display), hybrid
gpu_stack_mode: "{{ 'desktop' if deployment_profile | default('server') == 'workstation' else 'server' }}"

# GPU Reservation: host (host uses GPU), vfio (GPU reserved for VM passthrough)
# If 'vfio', kernel modules will not be loaded by this role.
gpu_stack_reservation: host

# Auto-detect architecture if possible (uses ansible_architecture)
# Can be overridden: x86_64, aarch64, riscv64
# Note: Should map to folders in arch/ directory. Logic in tasks/main.yml normalizes
# common variations (e.g. amd64 -> x86_64, arm64 -> aarch64).
gpu_stack_arch: "{{ ansible_facts['architecture'] }}"

# Advanced Features (Integration flags)
gpu_stack_enable_egpu: false         # Enable support for External GPUs (Thunderbolt/USB4/OCuLink)
gpu_stack_egpu_interface: thunderbolt # Connection type: thunderbolt (default), oculink
gpu_stack_enable_rdma: false         # Enable Remote Direct Memory Access support
gpu_stack_enable_dp_alt_mode: false  # Enable DisplayPort Alt Mode handling

# Compute Stack Enablement
gpu_stack_enable_oneapi: false       # Enable Intel OneAPI Base Toolkit (or runtime)
gpu_stack_enable_level_zero: false   # Enable Intel Level Zero (compute) support
gpu_stack_enable_cuda: false         # Enable NVIDIA CUDA Toolkit (compiler/dev tools)
gpu_stack_enable_rocm: false         # Enable AMD ROCm SDK

# Battlemage Specific
gpu_battlemage_force_probe: false    # Force probe for Intel Xe2 (Battlemage) GPUs

# Supply-chain hardening (optional key verification)
intel_oneapi_gpg_key_url: "https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS.PUB"
intel_oneapi_gpg_keyring_path: "/usr/share/keyrings/oneapi-archive-keyring.gpg"
intel_oneapi_repo: "deb [signed-by=/usr/share/keyrings/oneapi-archive-keyring.gpg] https://apt.repos.intel.com/oneapi all main"
intel_oneapi_gpg_fingerprint: "BF4385F91CA5FC005AB39E1C1A8497B11911E097"
intel_oneapi_gpg_fingerprint_verify: false

amd_rocm_gpg_key_url: "https://repo.radeon.com/rocm/rocm.gpg.key"
amd_rocm_gpg_keyring_path: "/etc/apt/keyrings/rocm.gpg"
amd_rocm_gpg_key_sha256: ""
amd_rocm_gpg_fingerprint: ""
amd_rocm_gpg_key_verify: false

# NVIDIA CUDA repository (RHEL-compatible (AlmaLinux/Rocky/CentOS Stream))
nvidia_gpg_key_url: "https://developer.download.nvidia.com/compute/cuda/repos/rhel{{ ansible_distribution_major_version }}/x86_64/D42D0685.pub"
nvidia_gpg_key_sha256: ""
nvidia_gpg_fingerprint: ""
nvidia_gpg_key_verify: false

# Desktop/Workstation Specific Configuration
# These settings apply when gpu_stack_mode is 'desktop' or 'hybrid'
gpu_desktop_enable_audio: true            # Enable GPU Audio (HDMI/DP) - Ensures drivers are loaded
gpu_desktop_power_profile: "balanced"     # Options: performance, balanced, power-saver
gpu_desktop_enable_wayland_support: true  # Enable DRM KMS for Wayland (essential for GNOME/KDE)
gpu_desktop_enable_x11_support: true      # Ensure X11 drivers/utilities are present
gpu_desktop_grant_user_access: true       # Grant 'video'/'render' group access to standard users

# Security and Evidence Encryption
# Default to true if deployment_profile is 'hardened', 'production', or 'ephemeral'
dsu_encrypt_evidence: "{{ true if deployment_profile | default('standard') in ['hardened', 'production', 'ephemeral'] else false }}"
dsu_encrypt_checkpoints: "{{ true if deployment_profile | default('standard') in ['hardened', 'production', 'ephemeral'] else false }}"

# Variable Namespacing:
# All variables internal to this role should be prefixed with gpu_stack_ or specific
# vendor prefixes (nvidia_, intel_, etc.) contained only within their specific
# inclusion files to avoid global namespace collisions.
